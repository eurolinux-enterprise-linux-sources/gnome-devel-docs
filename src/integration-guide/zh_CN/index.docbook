<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN" "http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">
<book id="index" lang="zh-CN">
  <bookinfo>
    <title>将现有软件集成到 GNOME</title>
    <subtitle>给独立软件开发者的指南</subtitle>
    <abstract role="description"><para>给独立软件开发者的指南</para></abstract>

    <authorgroup>
      <author>
	<firstname>Rosanna</firstname>
	<surname>Yuen</surname>
	<affiliation>
	  <address>
	    <email>zana@gnome.org</email>
	  </address>
	</affiliation>
      </author>
      <author role="maintainer">
	<firstname>Federico</firstname>
	<surname>Mena-Quintero</surname>
	<affiliation>
	  <address>
	    <email>federico@gnu.org</email>
	  </address>
	</affiliation>
      </author>
      <author>
	<firstname>Mike</firstname>
	<surname>Hearn</surname>
	<affiliation>
	  <address>
	    <email>mike@navi.cx</email>
	  </address>
	</affiliation>
      </author>
    </authorgroup>

    <copyright>
      <year>2005, 2006</year>
      <holder>Rosanna Yuen, Federico Mena-Quintero, Mike Hearn</holder>
    </copyright>

    <revhistory>
      <revision>
	<revnumber>0.6</revnumber>
	<date>2006/September/19</date>
	<revdescription>
	  <para>
	    Extended the icon guidelines.
	  </para>
	</revdescription>
      </revision>
 <revision>
	<revnumber>0.5</revnumber>
	<date>2006/September/18</date>
	<revdescription>
	  <para>
	    Integrated the content of Rosanna Yuen's first article on
	    freedesktop.org standards.
	  </para>
	</revdescription>
      </revision>
      <revision>
	<revnumber>0.0</revnumber>
	<date>June 2005</date>
	<revdescription>
	  <para>
	    Initial version of this document.
	  </para>
	</revdescription>
      </revision>
    </revhistory>
<!-- Added with permission of federico -->
<legalnotice id="legalnotice">
  <para>对于本文档的复制、分发和/或修改必须遵循自由软件基金会 (Free Software Foundation) 发布的 GNU 自由文档许可证 (GFDL) 版本 1.1 或更高版本，该许可证没有固定的部分、没有封面和背页文本。您可以在此<ulink type="help" url="ghelp:fdl">链接</ulink>上或在随本手册一起分发的 COPYING-DOCS 文件中找到 GFDL 的副本。</para>
  <para>本手册是在 GFDL 许可之下分发的 GNOME 手册集合的一部分。如果想要单独分发此手册，可以在手册中添加该许可证的一份副本然后分发，如该许可证的第 6 部分所述。</para>
  <para>各个公司使用的许多用于区别它们产品和服务的名称都声明为商标。在所有的 GNOME 文档以及 GNOME 文档项目的成员中，这些名称都是以全大写字母或首字母大写显示，从而表明它们是商标。</para>
  <para>
    DOCUMENT AND MODIFIED VERSIONS OF THE DOCUMENT ARE PROVIDED UNDER
    THE TERMS OF THE GNU FREE DOCUMENTATION LICENSE WITH THE FURTHER
    UNDERSTANDING THAT:
    <orderedlist>
      <listitem>
	<para>
	  DOCUMENT IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTY OF ANY
	  KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, WITHOUT LIMITATION,
	  WARRANTIES THAT THE DOCUMENT OR MODIFIED VERSION OF THE DOCUMENT
	  IS FREE OF DEFECTS MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE OR
	  NON-INFRINGING. THE ENTIRE RISK AS TO THE QUALITY, ACCURACY, AND
	  PERFORMANCE OF THE DOCUMENT OR MODIFIED VERSION OF THE DOCUMENT
	  IS WITH YOU. SHOULD ANY DOCUMENT OR MODIFIED VERSION PROVE
	  DEFECTIVE IN ANY RESPECT, YOU (NOT THE INITIAL WRITER, AUTHOR
	  OR ANY CONTRIBUTOR) ASSUME THE COST OF ANY NECESSARY SERVICING,
	  REPAIR OR CORRECTION. THIS DISCLAIMER OF WARRANTY CONSTITUTES
	  AN ESSENTIAL PART OF THIS LICENSE. NO USE OF ANY DOCUMENT OR
	  MODIFIED VERSION OF THE DOCUMENT IS AUTHORIZED HEREUNDER EXCEPT
	  UNDER THIS DISCLAIMER; AND
	</para>
      </listitem>
      <listitem>
	<para>
	  UNDER NO CIRCUMSTANCES AND UNDER NO LEGAL THEORY, WHETHER IN TORT
	  (INCLUDING NEGLIGENCE), CONTRACT, OR OTHERWISE, SHALL THE AUTHOR,
	  INITIAL WRITER, ANY CONTRIBUTOR, OR ANY DISTRIBUTOR OF THE DOCUMENT
	  OR MODIFIED VERSION OF THE DOCUMENT, OR ANY SUPPLIER OF ANY OF SUCH
	  PARTIES, BE LIABLE TO ANY PERSON FOR ANY DIRECT, INDIRECT, SPECIAL,
	  INCIDENTAL, OR CONSEQUENTIAL DAMAGES OF ANY CHARACTER INCLUDING,
	  WITHOUT LIMITATION, DAMAGES FOR LOSS OF GOODWILL, WORK STOPPAGE,
	  COMPUTER FAILURE OR MALFUNCTION, OR ANY AND ALL OTHER DAMAGES OR
	  LOSSES ARISING OUT OF OR RELATING TO USE OF THE DOCUMENT AND
	  MODIFIED VERSIONS OF THE DOCUMENT, EVEN IF SUCH PARTY SHALL HAVE
	  BEEN INFORMED OF THE POSSIBILITY OF SUCH DAMAGES.
	</para>
      </listitem>
    </orderedlist>
  </para>
</legalnotice>
  </bookinfo>

  <preface id="preface">
    <title>前言</title>

    <para>GNOME 是一个完全基于自由软件构建完整的桌面和开发平台的项目。很多公司、政府机构、学校、研究机构和个人在其系统上部署了 GNOME 桌面。如果您是第三方开发者(独立软件开发商 (<acronym>ISV</acronym>) 或者在不商业经营时，叫独立软件开发者 (<acronym>ISD</acronym>))，您可能希望确保您现有的软件可以在 GNOME 上正常运行。本文档解释怎样将现有软件和 GNOME 集成，而不用明确地使用 GNOME 平台库和开发工具重写软件。</para>

    <para>本指南在下列情况下会有用：</para>

    <itemizedlist>
      <listitem>
	<para>您是软件开发者或发行者，拥有一个不是明确的为 GNOME 而设计，但是您可能希望确保其可以在 GNOME 桌面较好的运行。</para>
      </listitem>

      <listitem>
	<para>您是为用户部署了 GNOME 桌的单位的系统管理员。您也有一些旧的或内部的应用程序，并且您希望您的 GNOME 用户可以方便地使用那些程序。</para>
      </listitem>

      <listitem>
	<para>您正在希望正确地编写一个 GNOME 应用程序，需要一些基本的检查项以确保您的应用程序可以和 GNOME 桌面的其它部分很好地集成。</para>
      </listitem>
    </itemizedlist>

    <para>本文档是关于集成现有软件到 GNOME 桌面的一般事项。另一方面，如果您正在考虑编写一个新应用程序，我们鼓励您完全使用 GNOME 作为目标平台，这方面的更多信息，请参考 <ulink url="http://developer.gnome.org">GNOME 开发者网站</ulink>。</para>

    <para>GNOME 的一项主要考虑是用户体验。用户应该有一个舒适的计算环境：这意味着有一个完整的桌面以及一套以相似方式运行的应用程序。通过很少的相关工作，不是明确地为 GNOME 编写的应用程序可以在 GNOME 桌面中舒适地使用。</para>

    <section id="structure">
      <title>本指南的结构</title>

      <para>本指南按照将软件和 GNOME 集成所需要的一系列任务进行组织。指南中，呈现这些任务时，大致以重要性进行排序。例如，向 GNOME 桌面菜单添加应用程序比添加拖放支持出现得早。同时，本指南也有一个 <link linkend="apx-integration-checklist">关于集成工作检查项的附录</link> 以帮助您对集成工作进行评估。</para>
    </section>

    <section id="standards">
      <title>freedesktop.org 和标准</title>

      <para>本指南中的很多集成任务依赖于标准，而不仅与 GNOME 相关。其它桌面环境项目，比如 <ulink url="http://www.kde.org">K 桌面环境</ulink> 也使用这些标准：如果您将应用程序和 GNOME 进行了集成，您应该只需要做很少的工作甚至完全不用做任何工作就可以让它们在其它桌面环境中同样好地运行。</para>

      <para>创造一个完美的应用程序是一种美妙的感觉。无论大小，您都会希望桌面环境可以识别您的应用程序并和它们进行适当的交互。对于当前可用的多种桌面环境，最好使您的应用程序可以和尽量多的桌面环境结合集成。尽管没有官方的规则，在 <emphasis>freedesktop.org</emphasis> 有一组规范。</para>

      <para>虽然不是一个正式的标准，freedesktop.org 维护了一组非正式但是普遍认可的方针。服从这些方针时，允许应用程序和兼容的桌面环境集成。</para>
    </section>
  </preface>

  <chapter id="basic-integration">
    <title>基本集成</title>

    <para>本章教您将一个程序集成到 GNOME 桌面的基本步骤。这些步骤考虑到了如下要求：</para>

    <itemizedlist>
      <listitem>
	<para>通过让程序出现在桌面面板菜单中或桌面的其它启动机制中，以方便用户启动程序。</para>
      </listitem>
      <listitem>
	<para>让桌面环境知道哪种类型的用户文件需要启动您的应用程序。</para>
      </listitem>
      <listitem>
	<para>让桌面环境知道如何为您的程序和程序创建的文件显示相应的图标。</para>
      </listitem>
    </itemizedlist>

    <section id="desktop-files">
      <title>桌面项文件：将您的应用程序放在桌面菜单中。</title>

      <para>要从 GNOME 中运行应用程序，用户需要点击他们桌面上的图标或者从菜单中选择。因此，将现有程序集成到 GNOME 的第一步就是将其 <firstterm>注册</firstterm> 为一组用户可用的程序。</para>

      <para>与 Windows 和 MacOS 不同，GNOME 中，用户菜单从注册了的应用程序列表自动组织。每个发布的应用程序指定其属于的一组类别，系统菜单配置对其进行排序和排列。此机制遵守 freedesktop.org 桌面想和菜单标准。</para>

      <note><para>虽然在其它桌面环境中很普遍，但是不推荐创建自己应用程序的子菜单。而是为您安装的每个程序提供一个菜单项。额外的项，比如帮助文件、README 或者到您网站的链接应该嵌入到应用程序自身中。</para></note>

      <para>在 GNOME 和其它兼容 freedesktop.org 的桌面环境中，应用程序通过 <firstterm>桌面项</firstterm> 注册到桌面菜单，桌面项是一个文本文件，使用 <filename>.desktop</filename> 作为扩展名。此桌面项文件包含了您应用程序的一系列配置。桌面从此文件中提取信息并将其用于：</para>

      <itemizedlist>
	<listitem>
	  <para>
	    put the application in the <guimenu>Main Menu</guimenu>. To find a list of
            valid categories, take a look into FreeDesktop.org's
	    <ulink url="http://standards.freedesktop.org/menu-spec/latest/">Desktop
	    Menu Specification</ulink>.
	  </para>
	</listitem>
	<listitem>
	  <para>在 <application>运行应用程序...</application> 对话框中列出应用程序</para>
	</listitem>
	<listitem>
	  <para>在菜单或桌面上创建适当的启动器。</para>
	</listitem>
	<listitem>
	  <para>组合应用程序的名称和描述</para>
	</listitem>
	<listitem>
	  <para>使用合适的图标。</para>
	</listitem>
	<listitem>
	  <para>识别它支持的 MIME 类型以便打开。</para>
	</listitem>
      </itemizedlist>

      <para>要为您的程序添加菜单项，请创建一个桌面项文件。它应该有一个独特的文件名，并且没有长度限制，所以请避免缩写，可以随便添加商标。然而，不要在文件名中使用空格和国际化字符。例如，"foocorp-painter-pro.desktop" 是一个比 "fcpp.desktop" 好的名称，"FooCorp Painter Pro.desktop" 也不是一个不好的文件名。文件应该是 UTF-8 编码的，并且应该遵守如下模板：</para>

      <programlisting><![CDATA[
	[Desktop Entry]
	Name=FooCorp Painter Pro
	Exec=foocorp-painter-pro
	Icon=foocorp-painter-pro
	Type=Application
	Categories=GTK;GNOME;Utility;
	]]></programlisting>

      <para>这些桌面项文件包含应用程序的元数据，在将程序和 GNOME 及其它兼容于标准的桌面环境集成中，起核心作用。此处给出的模板是最基本的。此文件可以包含翻译，以使用用户的本地语言显示程序名。</para>

      <para>
	Place this file in the
	<literal>/usr/share/applications</literal> directory so that
	it is accessible by everyone, or in
	<literal>~/.local/share/applications</literal> if you only
	wish to make it accessible to a single user.  Which is used
	should depend on whether your application is installed
	systemwide or into a user's home directory.  GNOME monitors
	these directories for changes, so simply copying the file to
	the right location is enough to register it with the
	desktop. <footnote>
	  <para>
	    Note that the
	    <literal>~/.local/share/applications</literal> location is
	    not monitored by versions of GNOME prior to version 2.10
	    or on Fedora Core Linux, prior to version 2.8.  These
	    versions of GNOME follow the now-deprecated vfolder
	    standard, and so desktop files must be installed to
	    <literal>~/.gnome2/vfolders/applications</literal>. This
	    location is not supported by GNOME 2.8 on Fedora Core nor
	    on upstream GNOME 2.10 so for maximum compatibility with
	    deployed desktops, put the file in both locations.
	  </para>

	  <para>
	    Note that the KDE Desktop requires one to run
	    <command>kbuildsycoca</command> to force a refresh of the
	    menus.
	  </para>

	<!-- MH: Actually I think some distros merge the old vfolders
	directory in so placing items in both locations will cause
	duplicate menu entries. Autopackage seems to have a program
	called "vfolder-magic" which modifies the vfolder
	definition in the users home directory. The comment at the
	top says:

	*  Program that adds or removes a desktop entry in
	*  ~/.gnome2/vfolders/applications.vfolder-info. This seems to be
	*  necessary with gnome 2.8, at least.

        -->
	</footnote>

	<!-- MH: Though this is a GNOME ISV guide, as so much of the
	basic integration work is also compatible with KDE it would
	be wise in my opinion to mention KDE and observe any quirks
	that are necessary to integrate correctly with that
	too. There's no real reason not to, ISVs want the maximum
	userbase possible (indeed, is this not what separates ISVs
	from your average open source project?).
        -->
      </para>

      <para>每个可以工作的桌面项文件需要遵守同样的格式。在 <xref linkend="ex-sample-desktop-file"/> 中给出了一个很小的桌面项文件示例。此文件被分为几个节，每部分以方括号扩起来的节描述开始。这个例子中，只有一个节，这是一个将桌面和程序集成的关键节。在每个节中，每行中等号之前的部分是 <firstterm>键</firstterm>，而另一部分是 <firstterm>值</firstterm>。在 <xref linkend="tb-desktop-file"/> 中，有对于每一行的解释。</para>

      <note>
	<para>除了标识桌面项文件的第一行，行的顺序并不重要。在 <xref linkend="ex-sample-desktop-file"/> 中，<command>Type=Application</command> 行是第二行，第五行或者是最后一行都无所谓。</para>

	<para>然而，键是区分大小写的。<command>Type=Application</command> 与 <command>type=Application</command> 或 <command>TYPE=Application</command> 并不相同。</para>
      </note>

      <example id="ex-sample-desktop-file">
	<title>桌面项文件示例</title>
<screen>
[Desktop Entry]
Type=Application
Encoding=UTF-8
Name=Sample Application Name
Comment=A sample application
Exec=application
Icon=application.png
Terminal=false
</screen>
      </example>

      <table id="tb-desktop-file">
	<title>一行行的解释</title>
	<tgroup cols="2">
	  <colspec colnum="1" colname="line" colwidth="1"/>
	  <colspec colnum="2" colname="desc" colwidth="1"/>

	  <thead>
	    <row>
	      <entry>行</entry>
	      <entry>解释</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><command>[Desktop Entry]</command></entry>
	      <entry>每个桌面项文件的第一行和每节的开头，标识与桌面集成的键值对块，是桌面正确识别文件所必须的。</entry>
	    </row>
	    <row>
	      <entry><command>Type=Application</command></entry>
	      <entry>Tells the desktop that this desktop file pertains to
		an application.  Other valid values for this key are
		<command>Link</command> and
		<command>Directory</command>.</entry>
	    </row>
	    <row>
	      <entry><command>Encoding=UTF-8</command></entry>
	      <entry>描述此桌面文件中的编码</entry>
	    </row>
	    <row>
	      <entry><command>Name=Sample Application Name</command></entry>
	      <entry>主菜单和任何启动器中您的应用程序的名称。</entry>
	    </row>
	    <row>
	      <entry><command>Comment=A sample application</command></entry>
	      <entry>描述这个应用程序。使用的是工具提示。</entry>
	    </row>
	    <row>
	      <entry><command>Exec=application</command></entry>
	      <entry>从 shell 中启动此应用程序的命令，可以有参数。</entry>
	    </row>
	    <row>
	      <entry><command>Icon=application.png</command></entry>
	      <entry>与此应用程序关联的图标名。</entry>
	    </row>
	    <row>
	      <entry><command>Terminal=false</command></entry>
	      <entry>说明程序是否在终端中运行。</entry>
	    </row>
	  </tbody>

	</tgroup>
      </table>

      <section id="commandline">
	<title>启动您的应用程序</title>
	<para>如果您的应用程序可以接受命令行参数，可以使用 <xref linkend="tb-exec-params"/> 中说明的字段。</para>

	<table id="tb-exec-params">
	  <title>Exec 变量</title>
	  <tgroup cols="2">
	    <colspec colnum="1" colname="line" colwidth="1"/>
	    <colspec colnum="2" colname="desc" colwidth="1"/>

	    <thead>
	      <row>
		<entry>添加...</entry>
		<entry>接受...</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><command>%f</command></entry>
		<entry>单个文件名</entry>
	      </row>
	      <row>
		<entry><command>%F</command></entry>
		<entry>多个文件名</entry>
	      </row>
	      <row>
		<entry><command>%u</command></entry>
		<entry>单个 URL。</entry>
	      </row>
	      <row>
		<entry><command>%U</command></entry>
		<entry>多个 URL。</entry>
	      </row>
	      <row>
		<entry><command>%d</command></entry>
		<entry>a single directory.  Used in conjunction with
		  <command>%f</command> to locate a file.</entry>
	      </row>
	      <row>
		<entry><command>%D</command></entry>
		<entry>multiple directories.  Used in conjunction with
		  <command>%F</command> to locate files.</entry>
	      </row>
	      <row>
		<entry><command>%n</command></entry>
		<entry>不带路径的单个文件名。</entry>
	      </row>
	      <row>
		<entry><command>%N</command></entry>
		<entry>不带路径的多个文件名。</entry>
	      </row>
	      <row>
		<entry><command>%k</command></entry>
		<entry>用来表示桌面项文件位置的 URI 或本地文件名。</entry>
	      </row>
	      <row>
		<entry><command>%v</command></entry>
		<entry>设备项的名称。</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</table>

      </section>

      <section id="internationalization">
	<title>其它语言</title>

	<para>要创建一个本地化的名称和注释，需要为每个区域添加行。例如，要添加中国大陆简体中文版的注释，添加如下行：</para>

	<para>
	  <command>
	    Comment[sv]=Exempelprogramnamn
	  </command>
	</para>

	<para>在文件中，没有翻译行的数目限制。</para>

	<tip>
	  <para>因为在一个文件中维护一个很长的翻译列表是很笨重的，一种更好的创建这些翻译的方法是使用 <application>intltool</application> 包。查看 <application>intltool-extract</application> 和 <application>intltool-merge</application> 手册页获取更多信息。</para>
	</tip>

      </section>

      <section id="desktop-references">
	<title>指南</title>

	<para><ulink url="http://standards.freedesktop.org/desktop-entry-spec/latest/index.html">桌面项规范</ulink> — 创建桌面项文件的规范。</para>
      </section>
    </section>

    <section id="icons">
      <title>安装图标</title>

      <para><xref linkend="ex-sample-desktop-file"/> 中，我们已经将此程序的图标指定为 <filename><replaceable>application.png</replaceable></filename>。我们需要将那个图标放置在正确的位置。</para>

      <para>桌面环境在 <filename>/usr/share/icons/</filename> 中选择的主题目录中查找图标。应用程序图标至少应该是 48x48 像素。将图标放置在 <filename>/usr/share/icons/hicolor/48x48/apps/</filename> 中。如果在选择的主题中没有为您的应用程序找到图标，就从这个目录中寻找。如果有对应于主题的图标，将它们放置在相应的目录中。</para>

      <para>为了更好的和 GNOME 桌面进行视觉集成，而同时也让程序在运行在 KDE, Windows XP 或 Mac OS X 时保持本地样式，创建您的艺术效果时，请遵守 <ulink url="http://tango.freedesktop.org/Tango_Icon_Theme_Guidelines">Tango 样式方针</ulink>。这份文档解释了图标设计的多个方面的问题，包括颜色、亮度和大小，同时也提供典型的工作流程和视频教程。</para>


      <section id="icons-references">
	<title>指南</title>

	<para><ulink url="http://standards.freedesktop.org/icon-theme-spec/icon-theme-spec-latest.html">图标主题规范</ulink> — 描述如何以可以使用主题的方式安装查找图标。</para>

	<para><ulink url="http://standards.freedesktop.org/icon-naming-spec/latest/">图标命名规范</ulink> — 提供一个典型的图标文件命名方案。</para>

	<para><ulink url="http://tango.freedesktop.org/Tango_Icon_Theme_Guidelines">Tango 样式方针</ulink> — 解释如何设计清晰和多平台的图标。</para>
      </section>
    </section>

    <section id="mime">
      <title>添加 MIME 类型</title>

      <para>如果您的程序可以打开指定的 MIME 类型，您需要在桌面项文件中告知桌面环境。例如，如果您的应用程序可以接受 <acronym>PNG</acronym>，向您的桌面项文件中添加如下行：</para>

      <para>
	<screen>MimeType=image/png</screen>
      </para>

      <para>可以通过分号分隔来添加另外的 MIME 类型。</para>

      <para>系统已经知晓了大量的 MIME 类型。然而，如果您创建了一个您自己的，你需要向 MIME 数据库注册您的 MIME 类型。在 <filename>/usr/share/mime/packages/</filename> 文件夹中，使用 <xref linkend="ex-mime-xml"/> 中给出的格式创建一个 <acronym>XML</acronym> 文件。</para>

      <example id="ex-mime-xml">
	<title>注册新 MIME 类型的示例文件</title>
<screen>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;mime-info xmlns="http://www.freedesktop.org/standards/shared-mime-info"&gt;
   &lt;mime-type type="application/x-<replaceable>example</replaceable>"&gt;
     &lt;comment&gt;Example file type &lt;/comment&gt;
     &lt;magic priority="50"&gt;
       &lt;match value="<replaceable>search-string</replaceable>" type="string" offset="10:140"/&gt;
     &lt;/magic&gt;
     &lt;glob pattern="*.<replaceable>newextension</replaceable>"/&gt;
   &lt;/mime-type&gt;
&lt;/mime-info&gt;
</screen>
      </example>

      <para>这个例子中，使用您自己的 MIME 类型替换例子中的 MIME 类型。<firstterm>magic</firstterm> 部分搜索文件以获取标识用的字符串。<firstterm>glob</firstterm> 行使用文件名的后缀来标识。</para>

      <tip>
	<para>因为 <command>magic</command> 命令强制计算机打开文件以搜索字符串，所以 <command>glob</command> 命令是更好的选择。</para>
      </tip>

      <para>文件中描述的新 MIME 类型适配好之后，在 shell 中运行如下命令：</para>

      <para>
	<screen>update-mime-database·/usr/share/mime</screen>
      </para>

      <tip>
	<para>关于选择一个适当的 MIME 扩展名和注册 MIME 类型的更多信息，请移步 <ulink url="http://www.iana.org/cgi-bin/mediatypes.pl">IANA</ulink> 网站。</para>
      </tip>

      <section id="mime-references">
	<title>指南</title>

	<para><ulink url="http://standards.freedesktop.org/shared-mime-info-spec/latest/">共享的 MIME 信息规范</ulink> — 详细说明 MIME 注册系统。</para>
      </section>

    </section>

  </chapter>

  <chapter id="deeper-integration">
    <title>桌面深度集成</title>

    <para>本章包含将软件与 GNOME 桌面更好集成所需要做的一系列需要更多的工作。例如，GNOME 可以在程序启动时显示反馈，您可以在 <xref linkend="startup-notification"/> 看到怎样启用这个反馈。如果您的软件创建文档或其它可显示的数据，您可以安装缩略图工具，以便让 GNOME 文件管理器创建您的程序指定的缩略图。</para>

    <section id="startup-notification">
      <title>启动时提示</title>

      <para>虽然 <xref linkend="desktop-files"/> 中显示的内容提供了让桌面识别您的程序的足够信息，但是还有一些其它内容在您的特定情况下可能会对您有用。这些内容中的一项就是 <firstterm>启动时提示</firstterm>。</para>

      <para>设置了启动时提示时，面板和光标提示用户程序已经启动，当程序出现在屏幕上时，面板和光标恢复正常。</para>

      <para>要让启动器知道您的程序支持启动时提示，向您的桌面文件添加如下行：</para>

      <para>
	<command>
	  StartupNotify=true
	</command>
      </para>

      <para>桌面项文件中的命令行允许桌面环境使用任何启动时提示，无论是内建在程序中还是工具集中。多数现代的工具集透明和启动时提示系统配合。如果您没有使用现代的工具集，<ulink url="http://freedesktop.org/wiki/Standards_2fstartup_2dnotification_2dspec">启动时提示规范</ulink> 中有怎样自己实现的细节。</para>

      <tip>
	<para>无论何种工具集，都有之中类型的应用程序您必须手动处理反馈。具有远程能力(让现有进程打开一个新窗口，而不是启动一个新进程)不能使用内置机制。DESKTOP_LAUNCH_ID 环境的值必须由您的程序传递并且让它通知新窗口的启动系统。如果您使用 <application>GTK+</application>，<function>gdk_notify_startup_complete()</function> 的文档有写更多的信息。</para>
      </tip>

      <section id="startup-notification-references">
	<title>指南</title>

	<para><ulink url="http://standards.freedesktop.org/startup-notification-spec/startup-notification-latest.txt">启动时提示协议</ulink> — 描述了在 X 窗口系统中启动时提示的实现细节。</para>
      </section>
    </section>

    <section id="thumbnailer">
      <title>安装缩略图程序</title>

      <para>GNOME 文件管理器，Nautilus，可以为每个文件显示小的特制缩略图，而不是在文件列表中的通用图标。例如，字处理文档可以显示为文档中首页的某种形式。因为用户可以看到文件中的小部分数据，可能可以帮助用户想起那个是他们在找的文件，所以这是有用的。您可以使用几个简单的步骤让您的程序创建这些缩略图。</para>

      <!-- FIXME: screenshot of Nautilus showing thumbnails -->

      <para><firstterm>缩略图程序</firstterm> 是一个没有用户界面的程序，它使用一个文件和一个像素尺寸作为输出，然后为那个文件写入缩略图。GNOME 根据要生成缩略图的文件的 MIME 类型决定使用哪个缩略图程序。MIME 类型和缩略图程序的影射存储为一系列的 GConf 键。</para>

      <para>对于每个想要处理的 MIME 类型，您必须创建一对 GConf 键：</para>

      <variablelist>
	<varlistentry>
	  <term><literal>/desktop/gnome/thumbnailers/<replaceable>application@x-foo</replaceable>/enable</literal></term>
	  <listitem>
	    <para>类型：boolean。决定是否运行此缩略图程序。您可以启用或禁用每个缩略图程序。当您安装一个新缩略图程序时，当然应该将这个键的值设置为 <symbol>true</symbol>。</para>
	  </listitem>
	</varlistentry>
	<varlistentry>
	  <term><literal>/desktop/gnome/thumbnailers/<replaceable>application@x-foo</replaceable>/command</literal></term>
	  <listitem>
	    <para>类型：字符串。GNOME 需要为 <replaceable>application@x-foo</replaceable> 文件生成缩略图时运行的命令。例如，值可以是 "<literal>application-x-foo-thumbnailer %i %o %s</literal>"。查看下边关于百分号的解释。</para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>也就是，每个 MIME 类型需要同路径下的两个 GConf 键 (<literal>enable</literal> 和 <literal>command</literal>)。路径名可以通过将 MIME 类型名中的 <literal>/</literal> 替换为 <literal>@</literal> 得到。例如，<literal>image/x-my-format</literal> 的缩略图程序需要两个键：<literal>/desktop/gnome/thumbnailers/image@x-my-format/enable</literal> 和 <literal>/desktop/gnome/thumbnailers/image@x-my-format/command</literal>。</para>

      <para>在 <literal>command</literal> 键中，GNOME 将查找当前的序列并将其替换为实际的值：</para>

      <informaltable frame="none">
	<tgroup cols="2">
	  <tbody valign="top">
	    <row>
	      <entry><literal>%i</literal></entry>
	      <entry>输入文件名。这是您的缩略图程序需要读取的文件。</entry>
	    </row>
	    <row>
	      <entry><literal>%u</literal></entry>
	      <entry>
		Input URI.  If your thumbnailer can handle URIs
		instead of plain file names, use <literal>%u</literal>
		instead of <literal>%i</literal>.
	      </entry>
	    </row>
	    <row>
	      <entry><literal>%o</literal></entry>
	      <entry>输出文件名。这是您的缩略图程序应该以 PNG 格式写入的缩略图文件。</entry>
	    </row>
	    <row>
	      <entry><literal>%s</literal></entry>
	      <entry>
		Size of the thumbnail as a single integer.  For
		example, if this gets substituted with
		<literal>128</literal>, it means that your thumbnailer
		should output an image no bigger than 128×128
		pixels.
	      </entry>
	    </row>
	  </tbody>
	</tgroup>
      </informaltable>

      <para><literal>%i</literal> 和 <literal>%u</literal> 中的一个必须出现在您的命令中，并且 <literal>%o</literal> 也是必须有的。<literal>%s</literal> 替代项是可选的，但是我们推荐您的缩略图程序对其进行关注。</para>

      <section>
	<title>附加信息</title>

	<para>对于更多的配置选项，您可以打开 boolean 键 <literal>/desktop/gnome/thumbnailers/disable_all</literal> 以禁止生成缩略图。</para>
      </section>

      <!-- FIXME: we mentioned the GConf keys, but not how to set them
      globally.  Do we need to describe how to install
      schemas/defaults? -->
    </section>

  </chapter>

  <appendix id="apx-integration-checklist">
    <title>集成检查清单</title>

    <para>本附录提供了一个本指南提供的多个任务的检查项。您可以使用这个检查项确定您的软件已经以基本的方法集成到了 GNOME，同时也是更多集成工作计划的资源。</para>

    <orderedlist>
      <listitem>
	<para>您的应用程序出现在 GNOME 面板的菜单中了吗？</para>
      </listitem>
      <listitem>
	<para>您的程序是否在菜单或面板上有图标？如果有，它使用提前制作好的多个大小还是一个可伸缩的 <acronym>SVG</acronym>？</para>
      </listitem>
      <listitem>
	<para>如果您的程序可以加载活保存文件，它注册到它可以处理的 MIME 类型了吗？</para>
      </listitem>
      <listitem>
	<para>您的应用程序为文件管理器提供 MIME 图标了吗？</para>
      </listitem>
      <listitem>
	<para>您的应用程序提供启动提示，以便 GNOME 可以在您的程序启动时提示用户吗？</para>
      </listitem>
      <listitem>
	<para>如果您的应用程序创建“可显示的”文档，它为文件管理器安装缩略图了吗？</para>
      </listitem>
    </orderedlist>
  </appendix>

  <appendix id="apx-acknowledgments">
    <title>致谢</title>

    <para>非常感谢 Jakub Steiner 为本指南的 HTML 版提供了一份漂亮的 CSS 样式表！</para>
  </appendix>

</book>
